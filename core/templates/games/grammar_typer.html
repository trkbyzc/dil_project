{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grammar Typer - Typing Challenge</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    /* Modern Grammar Typer Styles */
    :root {
      --primary-color: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --secondary-color: #f59e0b;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-light: #9ca3af;
      --bg-primary: #ffffff;
      --bg-secondary: #f9fafb;
      --bg-tertiary: #f3f4f6;
      --border-color: #e5e7eb;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
    }

    .background-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
    }

    .floating-shapes {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .shape {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: float 6s ease-in-out infinite;
    }

    .shape-1 { width: 80px; height: 80px; top: 10%; left: 10%; animation-delay: 0s; }
    .shape-2 { width: 120px; height: 120px; top: 20%; right: 10%; animation-delay: 2s; }
    .shape-3 { width: 60px; height: 60px; bottom: 20%; left: 20%; animation-delay: 4s; }
    .shape-4 { width: 100px; height: 100px; bottom: 10%; right: 20%; animation-delay: 1s; }
    .shape-5 { width: 40px; height: 40px; top: 50%; left: 50%; animation-delay: 3s; }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      position: relative;
      z-index: 1;
    }

    .main-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .logo-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      border-radius: var(--radius-xl);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-lg);
    }

    .logo-icon .material-icons {
      font-size: 2rem;
      color: white;
    }

    .title-group h1 {
      font-size: 3rem;
      font-weight: 800;
      color: white;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      margin: 0;
    }

    .title-group p {
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.9);
      margin: 0;
    }

    .modern-card {
      background: var(--bg-primary);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .card-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .card-header h2 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .card-header p {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .level-options {
      display: grid;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .level-option {
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .level-option input[type="radio"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .level-option label {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .level-option:hover label {
      border-color: var(--primary-light);
      background: rgba(99, 102, 241, 0.05);
    }

    .level-option input[type="radio"]:checked + label {
      border-color: var(--primary-color);
      background: rgba(99, 102, 241, 0.1);
    }

    .level-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .level-icon .material-icons {
      color: white;
      font-size: 1.5rem;
    }

    .level-info {
      flex: 1;
    }

    .level-info h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .level-info span {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .level-description {
      color: var(--text-light);
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .level-stats {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .stat .material-icons {
      font-size: 1rem;
    }

    .start-button {
      width: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: var(--shadow-md);
    }

    .start-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .start-button:active {
      transform: translateY(0);
    }

    .game-section {
      display: none;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .progress-container {
      flex: 1;
      min-width: 200px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-light) 100%);
      border-radius: var(--radius-sm);
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      text-align: center;
    }

    .game-stats {
      display: flex;
      gap: 1rem;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-color);
    }

    .stat-item .material-icons {
      color: var(--primary-color);
    }

    .stat-info {
      display: flex;
      flex-direction: column;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .timer-ring {
      position: relative;
      width: 40px;
      height: 40px;
      margin-left: 0.5rem;
    }

    .timer-svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .timer-circle-bg {
      fill: none;
      stroke: var(--bg-tertiary);
      stroke-width: 4;
    }

    .timer-circle {
      fill: none;
      stroke: var(--primary-color);
      stroke-width: 4;
      stroke-linecap: round;
      stroke-dasharray: 283;
      stroke-dashoffset: 283;
      transition: stroke-dashoffset 1s linear;
    }

    .sentence-display-container {
      margin-bottom: 2rem;
    }

    .sentence-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 2rem;
      text-align: center;
    }

    .sentence-label {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .turkish-sentence {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .typing-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .typing-input {
      flex: 1;
      padding: 1rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .typing-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .submit-button {
      background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      padding: 1rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .submit-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .feedback-message {
      text-align: center;
      padding: 1rem;
      border-radius: var(--radius-lg);
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .feedback-message.correct {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success-color);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .feedback-message.wrong {
      background: rgba(239, 68, 68, 0.1);
      color: var(--error-color);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .game-over {
      display: none;
    }

    .result-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .result-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      box-shadow: var(--shadow-lg);
    }

    .result-icon .material-icons {
      font-size: 2.5rem;
      color: white;
    }

    .result-header h2 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .final-score {
      font-size: 1.25rem;
      color: var(--text-secondary);
    }

    .performance-chart {
      display: flex;
      gap: 2rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .chart-item {
      text-align: center;
    }

    .chart-bar {
      width: 60px;
      height: 120px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      position: relative;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .chart-fill {
      position: absolute;
      bottom: 0;
      width: 100%;
      border-radius: var(--radius-lg);
      transition: height 0.8s ease;
      height: 0%;
    }

    .chart-item.correct .chart-fill {
      background: linear-gradient(180deg, var(--success-color) 0%, #059669 100%);
    }

    .chart-item.wrong .chart-fill {
      background: linear-gradient(180deg, var(--error-color) 0%, #dc2626 100%);
    }

    .chart-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .chart-label .material-icons {
      font-size: 1rem;
    }

    .mistake-summary {
      margin-bottom: 2rem;
    }

    .mistake-summary h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }

    .mistake-summary ul {
      list-style: none;
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .primary-button, .secondary-button {
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-lg);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      border: none;
    }

    .primary-button {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
    }

    .secondary-button {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .primary-button:hover, .secondary-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .floating-particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 50%;
      animation: particle-float 8s linear infinite;
    }

    .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
    .particle:nth-child(2) { left: 30%; animation-delay: 2s; }
    .particle:nth-child(3) { left: 50%; animation-delay: 4s; }
    .particle:nth-child(4) { left: 70%; animation-delay: 6s; }
    .particle:nth-child(5) { left: 90%; animation-delay: 1s; }

    @keyframes particle-float {
      0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) rotate(360deg);
        opacity: 0;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .title-group h1 {
        font-size: 2rem;
      }

      .game-header {
        flex-direction: column;
        align-items: stretch;
      }

      .game-stats {
        justify-content: center;
      }

      .typing-container {
        flex-direction: column;
      }

      .performance-chart {
        gap: 1rem;
      }

      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="background-animation">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
      <div class="shape shape-4"></div>
      <div class="shape shape-5"></div>
    </div>
  </div>
  
  <div class="container">
    <header class="main-header">
      <div class="logo-container">
        <div class="logo-icon">
          <span class="material-icons">keyboard</span>
        </div>
        <div class="title-group">
          <h1>Grammar Typer</h1>
          <p>Type Your Way to Perfect Grammar</p>
        </div>
      </div>
    </header>

    <div class="level-select modern-card" id="levelSelect">
      <div class="card-header">
        <h2>Choose Your Challenge</h2>
        <p>Select your typing challenge level</p>
      </div>
      
      <div class="level-options">
        <div class="level-option" data-level="A1-A2">
          <input type="radio" id="level-beginner" name="level" value="A1-A2" checked>
          <label for="level-beginner">
            <div class="level-icon">
              <span class="material-icons">school</span>
            </div>
            <div class="level-info">
              <h3>Beginner</h3>
              <span>A1-A2 Level</span>
              <div class="level-description">Simple sentences</div>
            </div>
            <div class="level-stats">
              <div class="stat">
                <span class="material-icons">timer</span>
                <span>15s per sentence</span>
              </div>
            </div>
          </label>
        </div>

        <div class="level-option" data-level="B1-B2">
          <input type="radio" id="level-intermediate" name="level" value="B1-B2">
          <label for="level-intermediate">
            <div class="level-icon">
              <span class="material-icons">trending_up</span>
            </div>
            <div class="level-info">
              <h3>Intermediate</h3>
              <span>B1-B2 Level</span>
              <div class="level-description">Complex structures</div>
            </div>
            <div class="level-stats">
              <div class="stat">
                <span class="material-icons">timer</span>
                <span>20s per sentence</span>
              </div>
            </div>
          </label>
        </div>

        <div class="level-option" data-level="C1-C2">
          <input type="radio" id="level-advanced" name="level" value="C1-C2">
          <label for="level-advanced">
            <div class="level-icon">
              <span class="material-icons">military_tech</span>
            </div>
            <div class="level-info">
              <h3>Advanced</h3>
              <span>C1-C2 Level</span>
              <div class="level-description">Professional level</div>
            </div>
            <div class="level-stats">
              <div class="stat">
                <span class="material-icons">timer</span>
                <span>25s per sentence</span>
              </div>
            </div>
          </label>
        </div>
      </div>

      <button class="start-button" id="startGame">
        <span class="material-icons">play_arrow</span>
        Start Challenge
      </button>
    </div>

    <section class="game-section modern-card" id="gameSection" style="display:none">
      <div class="game-header">
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text">
            <span id="questionNum">1</span> / <span id="totalQuestions">5</span>
          </div>
        </div>
        
        <div class="game-stats">
          <div class="stat-item score-stat">
            <span class="material-icons">stars</span>
            <div class="stat-info">
              <span class="stat-value" id="score">0</span>
              <span class="stat-label">Score</span>
            </div>
          </div>
          
          <div class="stat-item timer-stat">
            <span class="material-icons">schedule</span>
            <div class="stat-info">
              <span class="stat-value" id="time">15</span>
              <span class="stat-label">Time</span>
            </div>
            <div class="timer-ring" id="timerRing">
              <svg class="timer-svg" viewBox="0 0 100 100">
                <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                <circle class="timer-circle" cx="50" cy="50" r="45" id="timerCircle"></circle>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="sentence-display-container">
        <div class="sentence-card">
          <div class="sentence-label">Translate this sentence to English:</div>
          <div class="turkish-sentence" id="turkishSentence"></div>
        </div>
      </div>

      <div class="typing-container">
        <input type="text" id="userInput" class="typing-input" placeholder="Type your English translation here..." autocomplete="off" />
        <button class="submit-button" id="submitAnswer">
          <span class="material-icons">send</span>
          Submit
        </button>
      </div>
      
      <div class="feedback-message" id="feedback"></div>
    </section>

    <div class="game-over modern-card" id="gameOver" style="display:none">
      <div class="result-header">
        <div class="result-icon" id="resultIcon">
          <span class="material-icons">emoji_events</span>
        </div>
        <h2 id="resultTitle">Challenge Complete!</h2>
        <div class="final-score" id="finalScore"></div>
      </div>

      <div class="performance-chart">
        <div class="chart-item correct">
          <div class="chart-bar">
            <div class="chart-fill" id="correctBar"></div>
          </div>
          <div class="chart-label">
            <span class="material-icons">check_circle</span>
            <span>Correct</span>
            <span id="correctCount">0</span>
          </div>
        </div>
        
        <div class="chart-item wrong">
          <div class="chart-bar">
            <div class="chart-fill" id="wrongBar"></div>
          </div>
          <div class="chart-label">
            <span class="material-icons">cancel</span>
            <span>Wrong</span>
            <span id="wrongCount">0</span>
          </div>
        </div>
      </div>

      <div class="mistake-summary" id="mistakeSummary"></div>

      <div class="action-buttons">
        <button class="secondary-button" onclick="window.location.href='/'">
          <span class="material-icons">home</span>
          Home
        </button>
        <button class="primary-button" id="playAgain">
          <span class="material-icons">refresh</span>
          Play Again
        </button>
      </div>
    </div>
  </div>

  <div class="floating-particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <script>
    // Grammar Typer - Gramer Yazma Oyunu
    document.addEventListener("DOMContentLoaded", () => {
      console.log("Grammar Typer loaded!")
      
      // C√ºmle havuzlarƒ±
      const sentencePools = {
        "A1-A2": [
          { tr: "Ben √∂ƒürenciyim.", en: "I am a student" },
          { tr: "Bu bir elma.", en: "This is an apple" },
          { tr: "O mutlu.", en: "He is happy" },
          { tr: "Biz evdeyiz.", en: "We are at home" },
          { tr: "K√∂pek ko≈üuyor.", en: "The dog is running" },
          { tr: "Onlar okuldalar.", en: "They are at school" },
          { tr: "Ben kitap okuyorum.", en: "I am reading a book" },
          { tr: "O bir √∂ƒüretmen.", en: "She is a teacher" },
          { tr: "Biz mutluyuz.", en: "We are happy" },
          { tr: "Bu bir kalem.", en: "This is a pen" }
        ],
        "B1-B2": [
          { tr: "Ben bu kitabƒ± daha √∂nce okudum.", en: "I have read this book before" },
          { tr: "Yarƒ±n toplantƒ±ya katƒ±lacaƒüƒ±m.", en: "I will attend the meeting tomorrow" },
          { tr: "Onlar hi√ß ƒ∞stanbul'u ziyaret etmedi.", en: "They have never visited Istanbul" },
          { tr: "Araba tamir ediliyor.", en: "The car is being repaired" },
          { tr: "Film olduk√ßa ilgin√ßti.", en: "The movie was quite interesting" },
          { tr: "O ƒ∞ngilizce konu≈üabilir.", en: "He can speak English" },
          { tr: "D√ºn sinemaya gittik.", en: "We went to the cinema yesterday" },
          { tr: "O kitabƒ± hen√ºz bitirmedi.", en: "She hasn't finished the book yet" },
          { tr: "Bu odaya girmemelisin.", en: "You must not enter this room" },
          { tr: "Onlar √ßok √ßalƒ±≈üƒ±yorlar.", en: "They are working very hard" }
        ],
        "C1-C2": [
          { tr: "Eƒüer zamanƒ±m olsaydƒ±, sana yardƒ±m ederdim.", en: "If I had time, I would help you" },
          { tr: "Projeyi zamanƒ±nda tamamlamƒ±≈ü olmalƒ±.", en: "He must have completed the project on time" },
          { tr: "Sorular genellikle √∂ƒürencilere sorulur.", en: "The questions are usually asked to students" },
          { tr: "O konu≈ümayƒ± yapmadan √∂nce √ßok hazƒ±rlandƒ±.", en: "She prepared a lot before giving the speech" },
          { tr: "Hi√ß b√∂yle karma≈üƒ±k bir problem √ß√∂zmedim.", en: "I have never solved such a complex problem" },
          { tr: "Toplantƒ± ertelendi.", en: "The meeting was postponed" },
          { tr: "O kitabƒ± yazan adam ƒ∞ngilizmi≈ü.", en: "The man who wrote that book was English" },
          { tr: "ƒ∞≈üini zamanƒ±nda bitirmi≈ü olmalƒ±.", en: "He must have finished his work on time" },
          { tr: "Bu sorular genellikle √∂ƒürenciler tarafƒ±ndan sorulur.", en: "These questions are often asked by students" },
          { tr: "Daha fazla √ßalƒ±≈üsaydƒ±m, sƒ±navƒ± ge√ßerdim.", en: "If I had studied more, I would have passed the exam" }
        ]
      }

      // Oyun durumu
      let gameState = {
        level: null,
        sentences: [],
        currentIndex: 0,
        score: 0,
        correctAnswers: 0,
        wrongAnswers: 0,
        totalQuestions: 5,
        timeLeft: 0,
        maxTime: 0,
        timer: null,
        userAnswers: []
      }

      // DOM elementleri
      const levelSelect = document.getElementById("levelSelect")
      const gameSection = document.getElementById("gameSection")
      const gameOver = document.getElementById("gameOver")
      const startGameBtn = document.getElementById("startGame")
      const playAgainBtn = document.getElementById("playAgain")
      
      console.log("DOM Elements found:")
      console.log("levelSelect:", levelSelect)
      console.log("gameSection:", gameSection)
      console.log("gameOver:", gameOver)
      console.log("startGameBtn:", startGameBtn)
      
      const turkishSentence = document.getElementById("turkishSentence")
      const userInput = document.getElementById("userInput")
      const submitBtn = document.getElementById("submitAnswer")
      const feedback = document.getElementById("feedback")
      
      const progressFill = document.getElementById("progressFill")
      const questionNum = document.getElementById("questionNum")
      const totalQuestions = document.getElementById("totalQuestions")
      const scoreSpan = document.getElementById("score")
      const timeSpan = document.getElementById("time")
      const timerCircle = document.getElementById("timerCircle")
      
      const finalScore = document.getElementById("finalScore")
      const correctBar = document.getElementById("correctBar")
      const wrongBar = document.getElementById("wrongBar")
      const correctCount = document.getElementById("correctCount")
      const wrongCount = document.getElementById("wrongCount")
      const mistakeSummary = document.getElementById("mistakeSummary")

      // Yardƒ±mcƒ± fonksiyonlar
      function shuffle(array) {
        const newArray = [...array]
        for (let i = newArray.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [newArray[i], newArray[j]] = [newArray[j], newArray[i]]
        }
        return newArray
      }

      function normalize(text) {
        return text.toLowerCase().replace(/[.,!?'"]/g, "").trim()
      }

      function getTimeForLevel(level) {
        switch(level) {
          case "A1-A2": return 15
          case "B1-B2": return 20
          case "C1-C2": return 25
          default: return 15
        }
      }

      function updateProgress() {
        const progress = ((gameState.currentIndex + 1) / gameState.totalQuestions) * 100
        if (progressFill) progressFill.style.width = `${progress}%`
        if (questionNum) questionNum.textContent = gameState.currentIndex + 1
      }

      function updateTimer() {
        if (timerCircle) {
          const progress = gameState.timeLeft / gameState.maxTime
          const circumference = 2 * Math.PI * 45
          const offset = circumference * (1 - progress)
          timerCircle.style.strokeDashoffset = offset
        }
      }

      function updateUI() {
        if (scoreSpan) scoreSpan.textContent = gameState.score
        if (timeSpan) timeSpan.textContent = gameState.timeLeft
        updateProgress()
        updateTimer()
      }

      // Oyun fonksiyonlarƒ±
      function startGame() {
        console.log("Start game clicked!")
        
        const selectedLevel = document.querySelector('input[name="level"]:checked')?.value
        console.log("Selected level:", selectedLevel)
        
        if (!selectedLevel) {
          console.log("No level selected!")
          return
        }

        // Oyun durumunu sƒ±fƒ±rla
        gameState = {
          level: selectedLevel,
          sentences: shuffle(sentencePools[selectedLevel]).slice(0, 5),
          currentIndex: 0,
          score: 0,
          correctAnswers: 0,
          wrongAnswers: 0,
          totalQuestions: 5,
          timeLeft: 0,
          maxTime: getTimeForLevel(selectedLevel),
          timer: null,
          userAnswers: []
        }

        console.log("Game state initialized:", gameState)

        // Ekranlarƒ± deƒüi≈ütir
        if (levelSelect) {
          levelSelect.style.display = "none"
          console.log("Level select hidden")
        }
        if (gameSection) {
          gameSection.style.display = "block"
          console.log("Game section shown")
        }
        if (gameOver) {
          gameOver.style.display = "none"
          console.log("Game over hidden")
        }

        // UI'ƒ± g√ºncelle
        if (totalQuestions) totalQuestions.textContent = gameState.totalQuestions

        // ƒ∞lk soruyu ba≈ülat
        nextSentence()
      }

      function nextSentence() {
        console.log("Next sentence called, index:", gameState.currentIndex)
        
        if (gameState.currentIndex >= gameState.totalQuestions) {
          endGame()
          return
        }

        // Mevcut c√ºmleyi al
        const currentSentence = gameState.sentences[gameState.currentIndex]
        console.log("Current sentence:", currentSentence)
        
        if (turkishSentence) turkishSentence.textContent = currentSentence.tr

        // Input'u temizle ve odaklan
        if (userInput) {
          userInput.value = ""
          userInput.focus()
          userInput.disabled = false
        }

        if (submitBtn) submitBtn.disabled = false

        // Feedback'i temizle
        if (feedback) {
          feedback.textContent = ""
          feedback.className = "feedback-message"
        }

        // Timer'ƒ± ba≈ülat
        gameState.timeLeft = gameState.maxTime
        updateUI()
        startTimer()
      }

      function startTimer() {
        clearInterval(gameState.timer)
        gameState.timer = setInterval(() => {
          gameState.timeLeft--
          updateUI()

          if (gameState.timeLeft <= 0) {
            clearInterval(gameState.timer)
            handleSubmit(true) // timeout = true
          }
        }, 1000)
      }

      function handleSubmit(isTimeout = false) {
        console.log("Handle submit called, timeout:", isTimeout)
        
        clearInterval(gameState.timer)

        const currentSentence = gameState.sentences[gameState.currentIndex]
        const userAnswer = userInput ? userInput.value.trim() : ""
        const correctAnswer = currentSentence.en

        // Input'u devre dƒ±≈üƒ± bƒ±rak
        if (userInput) userInput.disabled = true
        if (submitBtn) submitBtn.disabled = true

        let isCorrect = false
        
        if (!isTimeout && userAnswer && normalize(userAnswer) === normalize(correctAnswer)) {
          isCorrect = true
          gameState.score += 20
          gameState.correctAnswers++
          
          if (feedback) {
            feedback.textContent = "Perfect! ‚úÖ"
            feedback.className = "feedback-message correct"
          }
        } else {
          gameState.wrongAnswers++
          
          if (feedback) {
            if (isTimeout) {
              feedback.innerHTML = `‚è∞ Time's up!<br><strong>Correct answer:</strong> ${correctAnswer}`
            } else if (!userAnswer) {
              feedback.innerHTML = `‚ùå Empty answer!<br><strong>Correct answer:</strong> ${correctAnswer}`
            } else {
              feedback.innerHTML = `‚ùå Wrong!<br><strong>Correct answer:</strong> ${correctAnswer}`
            }
            feedback.className = "feedback-message wrong"
          }
        }

        // Cevabƒ± kaydet
        gameState.userAnswers.push({
          turkish: currentSentence.tr,
          correct: correctAnswer,
          user: userAnswer || null,
          isCorrect: isCorrect,
          isTimeout: isTimeout
        })

        updateUI()

        // Sonraki soruya ge√ß
        setTimeout(() => {
          gameState.currentIndex++
          nextSentence()
        }, 2000)
      }

      function endGame() {
        console.log("End game called")
        
        clearInterval(gameState.timer)

        // Ekranlarƒ± deƒüi≈ütir
        if (gameSection) gameSection.style.display = "none"
        if (gameOver) gameOver.style.display = "block"

        // Sonu√ßlarƒ± hesapla
        const accuracy = Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100)

        // Final skorunu g√∂ster
        if (finalScore) {
          finalScore.innerHTML = `
            <div>Score: <strong>${gameState.score}</strong> / ${gameState.totalQuestions * 20}</div>
            <div>Accuracy: <strong>${accuracy}%</strong></div>
            <div>Correct: <strong>${gameState.correctAnswers}</strong> / Wrong: <strong>${gameState.wrongAnswers}</strong></div>
          `
        }

        // Grafikleri g√ºncelle
        if (correctCount) correctCount.textContent = gameState.correctAnswers
        if (wrongCount) wrongCount.textContent = gameState.wrongAnswers

        setTimeout(() => {
          const correctPercentage = (gameState.correctAnswers / gameState.totalQuestions) * 100
          const wrongPercentage = (gameState.wrongAnswers / gameState.totalQuestions) * 100
          
          if (correctBar) correctBar.style.height = `${correctPercentage}%`
          if (wrongBar) wrongBar.style.height = `${wrongPercentage}%`
        }, 500)

        // Hata √∂zetini g√∂ster
        showMistakeSummary()
      }

      function showMistakeSummary() {
        if (!mistakeSummary) return

        const mistakes = gameState.userAnswers.filter(answer => !answer.isCorrect)

        if (mistakes.length === 0) {
          mistakeSummary.innerHTML = `
            <div style="text-align: center; color: #10b981; font-weight: 600;">
              üéâ Perfect! All translations correct!
            </div>
          `
          return
        }

        let html = "<h3>Review Your Mistakes:</h3><ul>"
        mistakes.forEach((mistake, index) => {
          html += `
            <li style="margin-bottom: 1rem; padding: 1rem; border-left: 3px solid #ef4444; background: #fafafa;">
              <div><strong>Turkish:</strong> ${mistake.turkish}</div>
              <div><strong>Your answer:</strong> <span style="color: #ef4444;">${mistake.user || "No answer"}</span></div>
              <div><strong>Correct answer:</strong> <span style="color: #10b981;">${mistake.correct}</span></div>
            </li>
          `
        })
        html += "</ul>"

        mistakeSummary.innerHTML = html
      }

      function resetGame() {
        console.log("Reset game called")
        
        clearInterval(gameState.timer)
        
        // Ekranlarƒ± sƒ±fƒ±rla
        if (levelSelect) levelSelect.style.display = "block"
        if (gameSection) gameSection.style.display = "none"
        if (gameOver) gameOver.style.display = "none"

        // Progress bar'ƒ± sƒ±fƒ±rla
        if (progressFill) progressFill.style.width = "0%"
        if (correctBar) correctBar.style.height = "0%"
        if (wrongBar) wrongBar.style.height = "0%"
        if (timerCircle) timerCircle.style.strokeDashoffset = "283"
      }

      // Event listener'lar
      if (startGameBtn) {
        console.log("Adding click listener to start button")
        startGameBtn.addEventListener("click", startGame)
      } else {
        console.log("Start button not found!")
      }

      if (playAgainBtn) {
        playAgainBtn.addEventListener("click", resetGame)
      }

      if (submitBtn) {
        submitBtn.addEventListener("click", () => handleSubmit())
      }

      if (userInput) {
        userInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter" && !submitBtn.disabled) {
            handleSubmit()
          }
        })
      }

      // Ba≈ülangƒ±√ß durumu
      resetGame()
      console.log("Grammar Typer initialization complete!")
    })
  </script>
</body>
</html>
